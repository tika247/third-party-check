# 第3者チェックツール

## アプリ格納先

```
\\mikan\section\26_CC\1_DC\tools\03_第3者チェックツール
└third-party-check.zip
```

## GitLab

https://gitlab.mitsue.com/cc/tool/third-party-check

## アプリ起動までの流れ

1. アプリ格納先からzipファイルをローカルの任意の場所にコピーしてください
2. 解凍して`third-party-check Setup 0.1.0.exe`を実行してください
3. アプリが起動します
    - デスクトップにアイコンが追加されます。次回以降はアイコン実行でアプリ起動できます
    - アプリのプログラムは`C:\Users\UserName\AppData\Local\Programs\third-party-check\`に生成されています

## 初期設定

アプリを起動後、右上の設定アイコンをクリックし各情報を登録してください

- プロジェクトの追加ボタンからプロジェクト情報を入力してください
    - プロジェクト名
        - 例: 弥生
    - リポジトリのGitパス
        - 例: https://mlc-inc.backlog.com/git/CLI_YAYOI_PJT/YAYOI_KK.git
    - ローカルの作業フォルダパス
        - 例: D:\works\yayoi-kk\docs
- `WinMergeのexeファイルへのパス`に登録されているパスが正しいか確認してください
    - WinMergeのインストール先を変更していなければ、デフォルトのパスで問題ないはずです
- 言語を選択してください

## アプリの使い方

※ 部内の使用方針変更に従って適宜修正ください

1. Teamsで依頼を受けた第3者チェックの情報を参照し、入力画面の各項目を埋めてください
    - ブランチ名は一言一句実際のブランチ名と同一にする必要があります
    - Commitの新のみを入力した場合（古は未入力）、新とその1つ前のコミットの差分を取得します
    - Commitの新と古が未入力の場合、HEAD（最新のコミット）とその1つ前の差分を取得します
2. スタートボタン（→）を選択してください（入力情報が正しい場合、WinMergeが起動します）
3. 納品物を確認してください
    - WinMergeの画面だけでなく、フォルダ内やGitのコミットなども確認してください
4. 確認して問題なければ、BacklogとTeamsに問題ないことを報告してください
5. チェックボタンを選択してください
    - チェックボタンをクリックすることでGitの状態を作業前に戻ります
6. 希望するボタンを選択してください
    - リプレイボタン：再度チェックする
    - ファイルチェックボタン：納品物に不要なファイルが含まれているか機械的に確認する
    - 終了ボタン：アプリを終了する

※ 2でアプリが抽出した差分は一時的に`C:\Users\UserName\AppData\Local\Programs\third-party-check\resources\bat` の`@archive`に格納されます  
※ 6の`ファイルチェックボタン`は後述の`アプリによる納品物の自動チェック`を参照

## 使用上の注意

- 原則`release`ブランチを対象にアプリを使用してください
- 格納先がOneDriveにて管理されている場合、アプリは正常に動作しない可能性があります
- `アプリの使い方`の`5`は忘れず選択してください（*）
- アプリウィンドウの「×」ボタンはできるだけクリックしないでください（*）

（*）問題はありませんが、ブランチのチェックアウトや削除を手動で行う作業が発生します

## アプリによる納品物の自動チェック

`アプリの使い方`の`6`、ファイルチェックボタンを選択すると  
アプリが納品物に不要なファイルや記述がないか自動でチェックします

### チェック項目

1. ファイル名が同一（拡張子は異なる）のファイルが存在しているか
    - していればエラー
2. 納品物になりえないファイルが含まれているか
    - 定義された拡張子以外の拡張子のファイルが含まれていればエラー
        - 定義内容は[constants.ts](https://gitlab.mitsue.com/cc/tool/third-party-check/-/blob/main/src/constants.ts)の`expectedExtension`に記載
3. ダミーテキストなど未修正の文字列が含まれているか
    - 定義された文字列が含まれていればエラー
        - 定義内容は[constants.ts](https://gitlab.mitsue.com/cc/tool/third-party-check/-/blob/main/src/constants.ts)の`ngWord`に記載
4. 単色の画像が存在するか
   - 存在すればエラー

## アンインストール方法

1. 下記ファイルを実行してください  

```
C:\Users\UserName\AppData\Local\Programs\third-party-check\Uninstall third-party-check.exe
```

2. 下記のフォルダを削除してください

```
C:\Users\user-name\AppData\Roaming\third-party-check
```

↑のフォルダ直下`config.json`に登録したプロジェクトや言語選択、WinMergeのexeファイルパスといった情報が保存されています（localStorageのようなイメージ）。  
アンインストール前の保存情報を再インストール後も使用したい場合、　　

- config.jsonをバックアップ取っておく
- 再インストール後のconfig.jsonと比較し、必要な情報を加筆修正する

↑の手順で使用可能です。  
※↑の手順を踏まない場合、お手数ですが再度アプリ上で情報を登録ください

## 開発者用

アプリをメンテナンスする際は[参照](./DEVELOPER.md)